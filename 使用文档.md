# 使用文档（中文）

## 概述
这是一个基于 Flask + InsightFace 的人脸年龄/性别检测演示项目。可以通过网页上传图片或使用摄像头进行实时检测。

目录结构（简略）：
- `age/`：应用源码（`app.py`、模板等）
- `age/uploads/`：处理结果图片（已在 .gitignore 中忽略）
- `README.md`：仓库简介
- `使用文档.md`：本文件


## 先决条件
- Windows / Linux / macOS 的 Python 3.8+ 环境
- 推荐创建虚拟环境（venv 或 conda）以隔离依赖

## 安装依赖
项目根下已包含 `requirements.txt`（如需安装：）

```powershell
# 激活你的虚拟环境后
pip install -r requirements.txt
```

常见依赖包括：
- flask
- flask-socketio
- eventlet（或 gevent，若要生产部署请使用适当的 WSGI/SocketIO 服务）
- insightface
- onnxruntime
- opencv-python
- pillow
- numpy

注意：InsightFace 首次运行会下载模型（需联网），并且 onnxruntime 在 GPU 上的安装可能需要额外步骤。

## 运行应用（开发模式）
1. 进入应用目录并运行：

```powershell
cd D:\Code\age\age
python app.py
```

2. 打开浏览器并访问：http://127.0.0.1:5000

3. 上传图片或切换到摄像头模式进行实时推送。

## 常见问题与解决
- 找不到文件（FileNotFoundError）
  - 避免用相对路径从其他目录运行 `app.py`。项目已改为使用 `app.py` 所在目录的绝对 `uploads` 路径。确保 `app.py` 在 `age` 目录下运行：

```powershell
cd D:\Code\age\age
python app.py
```

- 摄像头无法打开：
  - 确认摄像头驱动工作正常，并且浏览器允许摄像头权限（前端的摄像头模式）。

- 推送到 GitHub 时出现 `Permission denied (publickey)` 或 HTTPS 认证错误：
  - 请参考 README 中关于 SSH 或 HTTPS + PAT 的步骤来配置认证。

## 上传模型（可选）
如果你希望把 InsightFace 的本地模型挂载到仓库，请不要把模型文件提交到 Git（体积大）。把模型放到 `age/models/` 并在 `.gitignore` 中保留忽略规则。

## 推送到 GitHub（快速提示）
1. 使用 SSH（推荐）
   - 生成 SSH key： `ssh-keygen -t ed25519 -C "your_email@example.com"`
   - 把公钥（`%USERPROFILE%\\.ssh\\id_ed25519.pub`）复制到 GitHub
   - 测试连接： `ssh -T git@github.com`

2. 使用 HTTPS + PAT
   - 在 GitHub 生成 Personal Access Token（repo 权限）
   - 设置 remote 为 HTTPS：
     `git remote set-url origin https://github.com/<user>/<repo>.git`
   - 推送时把 PAT 当作密码使用


## 其他注意事项
- `uploads/` 目录用于保存输出图片，已在 `.gitignore` 中忽略，不会被提交。
- 如果你要在生产环境部署，请使用更可靠的 WSGI 容器与静态文件托管方式（例如 nginx + gunicorn/uvicorn + socketio 后端适配）。

---
如果你需要我把该 `使用文档.md` 文件提交并推送到你的 GitHub，我可以现在尝试（会在推送阶段请求认证，若失败我会把错误信息贴出并给出下一步指引）。